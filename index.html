<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>éº»é›€ã‚¹ã‚³ã‚¢ç®¡ç†</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
:root{
  --green-dark:#0f3d2e;
  --green-base:#1f6f54;
  --plus:#1b7f4b;
  --minus:#b00020;
}
body{
  margin:0;
  padding:10px;
  padding-bottom:260px;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--green-dark);
  color:#fff;
}
body.light{background:#e6f4ef;color:#0f3d2e;}
h3{text-align:center;margin:6px 0;}

table{width:100%;border-collapse:collapse;}
.input-table{
  background:#f5f6f4;color:#000;
  border-radius:12px;overflow:hidden;
}
.input-table th{background:#e1e5e2;padding:6px;}
.input-table td{padding:6px;text-align:center;}
.input-table tr.active{background:#d9efe6;}

.cursor{opacity:0;margin-right:4px;}
tr.active .cursor{opacity:1;}

input.score{
  width:90px;font-size:20px;text-align:right;
  border:none;border-radius:8px;padding:6px;
}
.toggle{border:none;border-radius:8px;padding:6px 10px;}
.toggle.plus{background:#c8f5d4;}
.toggle.minus{background:#ffd6d6;}

.final.plus{color:var(--plus);}
.final.minus{color:var(--minus);}

button.main{
  width:32%;padding:12px 0;font-size:16px;
  border:none;border-radius:12px;
  background:linear-gradient(#3ba37a,#1f6f54);
  color:#fff;
}
button:disabled{opacity:.4}

.keypad{
  position:fixed;bottom:0;right:0;width:70%;
  background:#f5f6f4;padding:10px;
  display:grid;grid-template-columns:repeat(4,1fr);gap:8px;
}
.keypad button{
  padding:14px 0;font-size:20px;border:none;
  border-radius:12px;background:#fff;
}
.keypad button[data-k="clear"]{
  grid-column:span 3;background:#ffd6d6;
}
.keypad button[data-k="up"],
.keypad button[data-k="down"]{background:#e1e5e2;}

.score-table{
  margin-top:10px;
  background:#fff;color:#000;
  border-radius:12px;
  overflow:auto;
}
.score-table th,.score-table td{
  padding:6px;text-align:center;
  border-bottom:1px solid #ddd;
}
.plus{color:var(--plus);}
.minus{color:var(--minus);}
</style>
</head>

<body>

<h3>
åŠè˜ <span id="round">1</span>
<button id="themeToggle" style="float:right;">ğŸŒ™</button>
</h3>

<table class="input-table">
<tr><th>åå‰</th><th>ã‚¹ã‚³ã‚¢</th><th>ãƒˆãƒ“è³</th><th>æœ€çµ‚</th></tr>
<tr data-idx="0"><td><span class="cursor">â–¶</span>A</td><td><input class="score" readonly></td><td><button class="toggle"></button></td><td class="final"></td></tr>
<tr data-idx="1"><td><span class="cursor">â–¶</span>B</td><td><input class="score" readonly></td><td><button class="toggle"></button></td><td class="final"></td></tr>
<tr data-idx="2"><td><span class="cursor">â–¶</span>C</td><td><input class="score" readonly></td><td><button class="toggle"></button></td><td class="final"></td></tr>
<tr data-idx="3"><td><span class="cursor">â–¶</span>D</td><td><input class="score" readonly></td><td><button class="toggle"></button></td><td class="final"></td></tr>
</table>

<div style="display:flex;justify-content:space-between;margin-top:8px;">
  <button id="calc" class="main">è¨ˆç®—</button>
  <button id="save" class="main" disabled>ç™»éŒ²</button>
  <button id="show" class="main">ã‚¹ã‚³ã‚¢è¡¨ç¤º</button>
</div>

<div id="history" style="display:none;"></div>

<div class="keypad">
<button data-k="7">7</button><button data-k="8">8</button><button data-k="9">9</button><button data-k="up">â†‘</button>
<button data-k="4">4</button><button data-k="5">5</button><button data-k="6">6</button><button data-k="down">â†“</button>
<button data-k="1">1</button><button data-k="2">2</button><button data-k="3">3</button><button data-k="sign">Â±</button>
<button data-k="0">0</button><button data-k="clear">C</button>
</div>

<script>
const GAS_URL="â˜…â˜…â˜…GASã®URLâ˜…â˜…â˜…";
let cur=0,fresh=[1,1,1,1];

function focus(i){
  cur=Math.max(0,Math.min(3,i));
  fresh[cur]=1;
  $('tr[data-idx]').removeClass('active').eq(cur).addClass('active');
}
focus(0);

/* ãƒ†ãƒ³ã‚­ãƒ¼ */
$('.keypad button').on('click',function(){
  const k=$(this).data('k');
  const inp=$('tr[data-idx]').eq(cur).find('.score');
  let v=inp.val();

  if(k==='up')return focus(cur-1);
  if(k==='down')return focus(cur+1);
  if(fresh[cur]){inp.val('');v='';fresh[cur]=0;}
  if(k==='sign'&&v)inp.val(v[0]=='-'?v.slice(1):'-'+v);
  if(/[0-9]/.test(k))inp.val(v+k);
  if(k==='clear'){inp.val('');fresh[cur]=1;}
});

/* ã‚¹ã‚³ã‚¢è¡¨ç¤º */
$('#show').on('click',()=>{
  fetch(GAS_URL+'?mode=get')
  .then(r=>r.json())
  .then(d=>{
    let html='<div class="score-table"><table><tr><th>å›</th><th>A</th><th>B</th><th>C</th><th>D</th></tr>';
    let sum=[0,0,0,0];
    d.forEach((r,i)=>{
      html+=`<tr><td>${i+1}</td>`;
      r.score.forEach((v,j)=>{
        sum[j]+=v;
        html+=`<td class="${v>=0?'plus':'minus'}">${v}</td>`;
      });
      html+='</tr>';
    });
    html+='<tr><th>åˆè¨ˆ</th>'+sum.map(v=>`<th class="${v>=0?'plus':'minus'}">${v}</th>`).join('')+'</tr>';
    html+='</table></div>';
    $('#history').html(html).toggle();
  });
});

/* ãƒ†ãƒ¼ãƒ */
$('#themeToggle').on('click',()=>{
  $('body').toggleClass('light');
});
</script>

</body>
</html>
